{% extends 'reports/layout.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
    <div class="row">
    <a href="{{ previous }}" class="col-sm-1 btn btn-default h2">Předchozí</a>
    <h2 class="col-sm-10 text-center">Měsíční vyhodnocení pro {{ month }} {{ year }}</h2>
    <a href="{{ next }}" class="col-sm-1 btn btn-default h2">Další</a>
    </div>
    
    <script type="text/javascript" src="{% static 'reports/js/functions.js' %}"></script>
    <script type="text/javascript">
    $(document).ready(function(){
        
        new Chart($('[data-chart-expense]'), {
            type: 'horizontalBar',
            data : calculatePieChartData($('[data-table-expense]')),
            options : {
                responsive: true,
                title: true
            },
            label: "Výdaje"
        });
        
         new Chart($('[data-chart-revenue]'), {
            type: 'horizontalBar',
            data : calculatePieChartData($('[data-table-revenue]')),
            options : {
                responsive: true,
                title: true
            },
            label: "Příjmy"
        });
    });
    </script>
    
    <table class="table" data-table-expense>
        <colgroup>
            <col style="width: 40%">
            <col style="width: 15%">
            <col style="width: 15%">
            <col style="width: 15%">
            <col style="width: 15%">
        </colgroup>
        <thead>
            <tr>
                <th>Výdaje</th>
                <th>Celková Částka</th>
                <th>Nutné</th>
                <th>Navíc</th>
                <th>Spoření</th>
            </tr>
        </thead>
        <tbody>
            {% for expense in summary.expenses %}
                <tr data-table-row>
                    <td data-table-label>
                        {{ expense.name }}
                    </td>
                    <td class="alert alert-danger">
                       <a href="{% url 'record:type_month' type=expense.type month=monthId year=year %}">
                           <span data-table-amount>{{ expense.amount }}</span> {{ expense.currency }}
                       </a>
                    </td>
                    <td class="alert alert-danger">
                       <a href="{% url 'record:type_month' type=expense.type month=monthId year=year %}">
                           <span data-table-necessity-amount>{{ expense.necessity_amount|default:"---" }}</span> {{ expense.currency }} <br/>({{ expense.necessity_amount|percentage:expense.amount }} %)
                       </a>
                    </td>
                    <td class="alert alert-danger">
                       <a href="{% url 'record:type_month' type=expense.type month=monthId year=year %}">
                           <span data-table-nice-amount>{{ expense.nice_amount|default:"---"  }}</span> {{ expense.currency }} <br/>({{ expense.nice_amount|percentage:expense.amount }} %)
                       </a>
                    </td>
                    <td class="alert alert-danger">
                       <a href="{% url 'record:type_month' type=expense.type month=monthId year=year %}">
                           <span data-table-saving-amount>{{ expense.saving_amount|default:"---"  }}</span> {{ expense.currency }} <br/>({{ expense.saving_amount|percentage:expense.amount }} %)
                       </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
        <tfooter>
            <tr>
                <th>
                    Celkové výdaje
                </th>
                <th class="alert alert-danger">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.expense }} {{ summary.currency }}
                    </a>
                </th>
                <th class="alert alert-danger">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_expense.necessity|default:"---" }} {{ summary.currency }} <br/>({{ summary.categorized_expense.necessity|percentage:summary.expense }} %)
                    </a>
                </th>
                <th class="alert alert-danger">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_expense.nice|default:"---" }} {{ summary.currency }} <br/>({{ summary.categorized_expense.nice|percentage:summary.expense }} %)
                    </a>
                </th>
                <th class="alert alert-danger">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_expense.saving|default:"---" }} {{ summary.currency }} <br/>({{ summary.categorized_expense.saving|percentage:summary.expense }} %)
                    </a>
                </th>
            </tr>
        </tfooter>
    </table>
    
    <canvas data-chart-expense/></div>
    
    <table class="table" data-table-revenue>
        <colgroup>
            <col style="width: 40%">
            <col style="width: 15%">
            <col style="width: 15%">
            <col style="width: 15%">
            <col style="width: 15%">
        </colgroup>
        <thead>
            <tr>
                <th>Příjmy</th>
                <th>Částka</th>
                <th>Nutné</th>
                <th>Navíc</th>
                <th>Spoření</th>
            </tr>
        </thead>
        <tbody>
            {% for revenue in summary.revenues %}
                <tr data-table-row>
                    <td data-table-label>
                        {{ revenue.name }}
                    </td>
                    <td class="alert alert-success">
                         <a href="{% url 'record:type_month' type=revenue.type month=monthId year=year %}"><span data-table-amount>{{ revenue.amount }}</span> {{ revenue.currency }}</a>
                    </td>
                    <td class="alert alert-success">
                       <a href="{% url 'record:type_month' type=revenue.type month=monthId year=year %}">
                           <span data-table-necessity-amount>{{ revenue.necessity_amount|default:"---" }}</span> {{ revenue.currency }} <br/>({{ revenue.necessity_amount|percentage:revenue.amount }} %)
                       </a>
                    </td>
                    <td class="alert alert-success">
                       <a href="{% url 'record:type_month' type=revenue.type month=monthId year=year %}">
                           <span data-table-nice-amount>{{ revenue.nice_amount|default:"---"  }}</span> {{ revenue.currency }} <br/>({{ revenue.nice_amount|percentage:revenue.amount }} %)
                       </a>
                    </td>
                    <td class="alert alert-success">
                       <a href="{% url 'record:type_month' type=revenue.type month=monthId year=year %}">
                           <span data-table-saving-amount>{{ revenue.saving_amount|default:"---"  }}</span> {{ revenue.currency }} <br/>({{ revenue.saving_amount|percentage:revenue.amount }} %)
                       </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
        <tfooter>
            <tr>
                <th>
                    Celkové příjmy
                </th>
                <th class="alert alert-success">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.revenue }} {{ summary.currency }}
                    </a>
                </th>
                <th class="alert alert-success">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_revenue.necessity|default:"---" }} {{ summary.currency }} <br/>({{ summary.categorized_revenue.necessity|percentage:summary.revenue }} %)
                    </a>
                </th>
                <th class="alert alert-success">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_revenue.nice|default:"---" }} {{ summary.currency }} <br/>({{ summary.categorized_revenue.nice|percentage:summary.revenue }} %)
                    </a>
                </th>
                <th class="alert alert-success">
                     <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_revenue.saving|default:"---" }} {{ summary.currency }} <br/>({{ summary.categorized_revenue.saving|percentage:summary.revenue }} %)
                    </a>
                </th>
            </tr>
        </tfooter>
    </table>
    
    
    <canvas data-chart-revenue/></div>
    
    <table class="table">
        <colgroup>
            <col style="width: 40%">
            <col style="width: 15%">
            <col style="width: 15%">
            <col style="width: 15%">
            <col style="width: 15%">
        </colgroup>
        <thead>
            <tr>
                <th>Výsledek měsíce</th>
                
                <th
                    {% if summary.summary >= 0 %}
                        class="alert alert-success"
                    {% else %}
                        class="alert alert-danger"
                    {% endif %}
                >
                    <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.summary }} {{ summary.currency }}
                    </a>
                </th>

                <th
                    {% if summary.categorized_summary.necessity >= 0 %}
                        class="alert alert-success"
                    {% else %}
                        class="alert alert-danger"
                    {% endif %}
                >
                    <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_summary.necessity|default:"---" }} {{ summary.currency }}
                    </a>
                </th>

                <th
                    {% if summary.categorized_summary.nice >= 0 %}
                        class="alert alert-success"
                    {% else %}
                        class="alert alert-danger"
                    {% endif %}
                >
                    <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_summary.nice|default:"---" }} {{ summary.currency }}
                    </a>
                </th>

                <th
                    {% if summary.categorized_summary.saving >= 0 %}
                        class="alert alert-success"
                    {% else %}
                        class="alert alert-danger"
                    {% endif %}
                >
                    <a href="{% url 'record:month' month=monthId year=year %}">
                        {{ summary.categorized_summary.saving|default:"---" }} {{ summary.currency }}
                    </a>
                </th>
            </tr>
        </thead>
    </tbody>
    </table>
{% endblock %}